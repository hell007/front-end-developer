
**问题描述：**网站资源的流量变得越来越大。大部分的网站流量均来自图片。因此对图片合理优化可以大幅影响网站流量，减小带宽消耗和服务器压力

### 一、目前网站采用最多的图片格式

	jpg  png  gif  svg

其他格式的图片

webp apng bpg ...


颜色丰富的照片，JPG是通用的选择

人眼的结构很适合查看JPG压缩后的照片，可以充分的忽略并在脑中补齐细节
JPG在压缩率不高时保留的细节还是不错的
WebP能够比JPG减少30%的体积，但目前兼容性较差
如果需要较通用的动画，GIF是唯一可用的选择

GIF支持的颜色范围为256色，而且仅支持完全透明/完全不透明
GIF在显示颜色丰富的动画时可能出现颜色不全、边缘锯齿等问题
如果图片由标准的几何图形组成，或需要使用程序动态控制其显示特效，可以考虑SVG格式

SVG是使用XML定义的矢量图形，生成的图片在各种分辨率下均可自由放缩
SVG中可以通过JavaScript等接口自由变换图片特效，可以完成其中部分元素的自由旋转、移动、变换颜色等
如果需要清晰的显示颜色丰富的图片，PNG比较好

PNG-8能够显示256种颜色，但能够同时支持256阶透明，因此颜色数较少但需要半透明的情景（如微信动画大表情）可以考虑PNG-8
PNG-24可以显示真彩色，但不支持透明，颜色丰富的图片推荐使用（如屏幕截图、界面设计图）
PNG-32可以显示真彩色，同时支持256阶透明，效果最好但尺寸也最大


### 二、前端的图片优化方案


#### 使用base64编码代替图片

场景：适用于图片大小小于2KB，页面上引用图片总数不多的情况 

原理：将图片转换为base64编码字符串inline到页面或css中 

优势：减少http的请求次数，并可以放到后台数据库中，只传输字符串，有较多的构建工具可以直接实现 

劣势：这种方法仅限于图片总数较少，而且图片大小小于2KB的情况。否则图片字符串会变得很长很长


#### 合并图片sprite(雪碧图)

场景：任何用到页面图片的场景 

原理：将多个页面上用到的背景图片合并成一个大的图片在css中引用 

优势：可以有效的较少请求个数，而且，而不影响开发体验，使用构建插件可以做到对开发者透明。适用于页面图片多且丰富的场景。

劣势：生成的图片体积较大，减少请求个数同时也增加了图片大小，不合理拆分将不利于并行加载


#### 使用css、svg、canvas或iconfont代替图片

##### css代替图片

场景：适用于移动端或较高级的浏览器，而且绘制的图案较为简单。 

原理：css方式可以用来绘制相对简单的团来代替图片，一般使用before或者after伪元素来丰富图案的复杂度。 

优势：具有实现简单，图片体积小的特点，可以实现简单的动态效果 

劣势：也受限于css的兼容性特点，绘制复杂图案困难

##### canvas代替图片 

场景：需要高性能的图片或动画 

原理：适用html5的canvas元素绘制创建图片 

优势：整个就是画2D图形时，页面渲染性能比较高，页面渲染性能受图形复杂度影响小，性能只受图形的分辨率的影响，画出来的图形可以直接保存为 .png 或者 .jpg的图形，适合于画光栅图像或者不规则图形 

劣势：没有dom操作，必须依赖定时器，文字渲染性能差，不能添加描述(title属性什么的)，兼容性限制

##### iconfont是一种web字体来代替图片的解决方案

场景：代替页面上色彩单一的图片 

优势：兼容性好，应用广，目前使用也很广泛 

劣势：但是由于字体的颜色设置单一，只能用于代替颜色单一的图片，对于色彩复杂的图片，iconfont处理起来比较困难

#### 响应式图片

场景：不同终端对同一个图片需求不一样，可以根据终端加载不同的图片来节省没必要的流量 

原理：通过picture元素，picturefill或平台判断来为不同终端平台输出不同的图片 

优势：减少没必要的图片加载，灵活控制，慢速用户加载小图片不至于加载失败，移动端没必要加载大尺寸图片等，可以通过不同方式兼容所有浏览器 

劣势：无法避免图片的加载过程，图片本身没优化

#### 图片压缩

场景：在不得不加载图片的前提下，要进一步提升优化效果，只能通过有损或无损压缩来减少图片的大小。 

原理：对图片进行无损、有损压缩，转为压缩后图片来实现 

优势：减少图片加载流量，效果比较明显 

劣势：服务器和浏览器压力增大，而且服务器需要额外的服务支持

##### 图片压缩工具/网站

[tinyPng](https://tinypng.com)

tinyPng 压缩图片质量好，体积也小，速度慢，压缩图片数量有限制

[智图](http://zhitu.isux.us/)


ImageOptim    Image Optimizer5.0.exe

需要图片格式分类压缩，体积相对于原图减小一半，图片质量稍微有点影响

自动优化：Grunt/Gulp

图片体积变化不大



#### 更好的图片格式

场景：之前说到webp、bpg等新图片格式具有更好的压缩比，可以使用这类新型的图片来代替原始图片 

原理：对图片格式转换，在画质可以接受的情况下达到更好的压缩比效果 

优势：减少图片加载流量，效果比较明显 

劣势：服务器和浏览器压力增大，而且服务器需要额外的服务支持，格式转换要考虑浏览器的兼容性


## 总结：

	开发可行方案：

	使用base64编码代替图片

	合并图片sprite(雪碧图)

	iconfont字体图标

	图片压缩

